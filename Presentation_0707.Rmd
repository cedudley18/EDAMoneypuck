---
title: "Initial Tasks with Moneypuck Data"

author: 
  - "Claire Dudley, Devin Basley"
  - "Ruby Wu, Sara Armstrong" 
date: 'July 7th, 2021'
output: 
  xaringan::moon_reader:
    css: xaringan-themer.css
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
    fig.retina = 3,
    cache = FALSE,
    echo = FALSE,
    message = FALSE,
    warning = FALSE,
    fig.show = TRUE,
    hiline = TRUE)
```

```{r xaringan-themer, include = FALSE, warning = FALSE}
library(xaringanthemer)
style_mono_accent(base_color = "#4d54a5",
  white_color = "#FFFFFF",
  background_color = "#FFFFFF",
  base_font_size = "24px"
)
```

```{r load packages and data}
# Load packages
library(tidyverse)
library(data.table)
library(sjPlot)

# Load data
shots2020 <- read_csv("shots_data/shots_2020.csv")
shots0719 <- read.csv("shots_data/shots_2007-2019.csv")

# Filter data
shots1019 <- shots0719 %>% 
  filter(season>2009)

recent_season <- rbind(select(shots1019,shotGoalieFroze,shotPlayContinuedInZone,shotPlayContinuedOutsideZone,season,shotAngleAdjusted,arenaAdjustedShotDistance,goal,shotGeneratedRebound),select(shots2020,shotGoalieFroze,shotPlayContinuedInZone,shotPlayContinuedOutsideZone,season,shotAngleAdjusted,arenaAdjustedShotDistance,goal,shotGeneratedRebound))

dat_list = split(recent_season, recent_season$season)
```


## The problem

---

### How much does that increase matter

```{r echo=FALSE,fig.align="center", fig.show="hold", out.width="80%",fig.width = 9, fig.height = 3.5}

init_logit <- map(dat_list, ~glm(goal ~                        shotAngleAdjusted+arenaAdjustedShotDistance,
                                 data = .x,
                                 family = binomial("logit")) )

distance<- rep(NA,11)
angle<-rep(NA,11)

for (i in 1:11){
  distance[i] <- init_logit[[i]]$coefficients[3]
  angle[i]<- init_logit[[i]]$coefficients[2]
}

coefficients<- data.frame(season= as.factor(2010:2020) ,distance_c= distance, angle_c = angle)

ggplot(coefficients,aes(x=season,y=distance_c))+
  geom_point()+
  geom_line(aes(group=1))+
  labs(title = "xG Coefficient Trends Over Time: Distance",
       x = "Season",
       y = "Shot Distance Coefficient")+
  theme_bw()+
  theme(axis.title.x = element_text(size=16),
           axis.title.y = element_text(size=16),
           plot.title = element_text(size = 20,face = "bold"))
  
ggplot(coefficients,aes(x=season,y=angle_c))+
  geom_point()+
  geom_line(aes(group=1))+
  labs(title = "xG Coefficient Trends Over Time: Angle",
       x = "Season",
       y = "Shot Angle Coefficient")+
  theme_bw()+
  theme(axis.title.x = element_text(size=16),
           axis.title.y = element_text(size=16),
           plot.title = element_text(size = 20, face = "bold"))
```


---



### How much does that increase matter

```{r}
average<-data.frame(arenaAdjustedShotDistance=mean(recent_season$arenaAdjustedShotDistance),shotAngleAdjusted=mean(recent_season$shotAngleAdjusted))
```

Plug the mean distance and angle to 2010 xG model

```{r}
predict(init_logit[[1]],average,type = "response")[[1]]
```

Plug the mean distance and angle to 2018 xG model

```{r}
predict(init_logit[[9]],average,type = "response")[[1]]
```


---

### shotGoalieFroze Model with Logistic Regression

```{r}
SGF_logit<-glm(shotGoalieFroze ~                        shotAngleAdjusted+arenaAdjustedShotDistance,
               data = recent_season,
               family = binomial("logit")) 

```


---


### shotGoalieFroze Coefficient Trends Over Time

```{r echo=FALSE,fig.align="center", fig.show="hold", out.width="80%",fig.width = 9, fig.height = 3.5}

init_logit <- map(dat_list, ~glm(shotGoalieFroze ~                        shotAngleAdjusted+arenaAdjustedShotDistance,
                                 data = .x,
                                 family = binomial("logit")) )

distance<- rep(NA,11)
angle<-rep(NA,11)

for (i in 1:11){
  distance[i] <- init_logit[[i]]$coefficients[3]
  angle[i]<- init_logit[[i]]$coefficients[2]
}

coefficients<- data.frame(season= as.factor(2010:2020) ,distance_c= distance, angle_c = angle)

ggplot(coefficients,aes(x=season,y=distance_c))+
  geom_point()+
  geom_line(aes(group=1))+
  labs(title = "Distance",
       x = "Season",
       y = "Shot Distance Coefficient")+
  theme_bw()+
  theme(axis.title.x = element_text(size=16),
        axis.title.y = element_text(size=16),
        plot.title = element_text(size = 20,face = "bold"))

ggplot(coefficients,aes(x=season,y=angle_c))+
  geom_point()+
  geom_line(aes(group=1))+
  labs(title = "Angle",
       x = "Season",
       y = "Shot Angle Coefficient")+
  theme_bw()+
  theme(axis.title.x = element_text(size=16),
        axis.title.y = element_text(size=16),
        plot.title = element_text(size = 20, face = "bold"))

```

---

### shotPlayContinuedInZone Model with Logistic Regression

```{r}
SPCIZ_logit<-glm(shotPlayContinuedInZone ~                        shotAngleAdjusted+arenaAdjustedShotDistance,
               data = recent_season,
               family = binomial("logit")) 

```


---


### shotPlayContinuedInZone Coefficient Trends Over Time

```{r echo=FALSE,fig.align="center", fig.show="hold", out.width="80%",fig.width = 9, fig.height = 3.5}

init_logit <- map(dat_list, ~glm(shotPlayContinuedInZone ~                        shotAngleAdjusted+arenaAdjustedShotDistance,
                                 data = .x,
                                 family = binomial("logit")) )

distance<- rep(NA,11)
angle<-rep(NA,11)

for (i in 1:11){
  distance[i] <- init_logit[[i]]$coefficients[3]
  angle[i]<- init_logit[[i]]$coefficients[2]
}

coefficients<- data.frame(season= as.factor(2010:2020) ,distance_c= distance, angle_c = angle)

ggplot(coefficients,aes(x=season,y=distance_c))+
  geom_point()+
  geom_line(aes(group=1))+
  labs(title = "Distance",
       x = "Season",
       y = "Shot Distance Coefficient")+
  theme_bw()+
  theme(axis.title.x = element_text(size=16),
        axis.title.y = element_text(size=16),
        plot.title = element_text(size = 20,face = "bold"))

ggplot(coefficients,aes(x=season,y=angle_c))+
  geom_point()+
  geom_line(aes(group=1))+
  labs(title = "Angle",
       x = "Season",
       y = "Shot Angle Coefficient")+
  theme_bw()+
  theme(axis.title.x = element_text(size=16),
        axis.title.y = element_text(size=16),
        plot.title = element_text(size = 20, face = "bold"))

```

---

### shotPlayContinuedOutsideZone Model with Logistic Regression

```{r}
SPCOZ_logit<-glm(shotPlayContinuedOutsideZone ~                        shotAngleAdjusted+arenaAdjustedShotDistance,
               data = recent_season,
               family = binomial("logit")) 

```


---


### shotPlayContinuedOutsideZone Coefficient Trends Over Time

```{r echo=FALSE,fig.align="center", fig.show="hold", out.width="80%",fig.width = 9, fig.height = 3.5}

init_logit <- map(dat_list, ~glm(shotPlayContinuedOutsideZone ~                        shotAngleAdjusted+arenaAdjustedShotDistance,
                                 data = .x,
                                 family = binomial("logit")) )

distance<- rep(NA,11)
angle<-rep(NA,11)

for (i in 1:11){
  distance[i] <- init_logit[[i]]$coefficients[3]
  angle[i]<- init_logit[[i]]$coefficients[2]
}

coefficients<- data.frame(season= as.factor(2010:2020) ,distance_c= distance, angle_c = angle)

ggplot(coefficients,aes(x=season,y=distance_c))+
  geom_point()+
  geom_line(aes(group=1))+
  labs(title = "Distance",
       x = "Season",
       y = "Shot Distance Coefficient")+
  theme_bw()+
  theme(axis.title.x = element_text(size=16),
        axis.title.y = element_text(size=16),
        plot.title = element_text(size = 20,face = "bold"))

ggplot(coefficients,aes(x=season,y=angle_c))+
  geom_point()+
  geom_line(aes(group=1))+
  labs(title = "Angle",
       x = "Season",
       y = "Shot Angle Coefficient")+
  theme_bw()+
  theme(axis.title.x = element_text(size=16),
        axis.title.y = element_text(size=16),
        plot.title = element_text(size = 20, face = "bold"))

```

---


## Heat map of Predicted values



---